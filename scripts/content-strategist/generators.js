/**
 * –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Claude API
 */

import { generateContent, generateContentStream } from './claude-api.js';
import { print, printSection, printSubsection, analyzeSuccessfulPatterns } from './utils.js';

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é
 */
export async function generateInterviewQuestions(context, showProgress = true) {
  if (showProgress) {
    printSection('‚ùì –ì–ï–ù–ï–†–ê–¶–ò–Ø –í–û–ü–†–û–°–û–í –î–õ–Ø –ò–ù–¢–ï–†–í–¨–Æ');
    print('\n–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–µ–º—É –∏ —Ñ–æ—Ä–º–∏—Ä—É—é –≤–æ–ø—Ä–æ—Å—ã...', 'cyan');
  }

  const patterns = analyzeSuccessfulPatterns();

  const prompt = `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –≤ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∏–Ω—Ç–µ—Ä–≤—å—é –¥–ª—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–≥–æ –±–ª–æ–≥–∞.

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
${JSON.stringify(context, null, 2)}

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–≥–∞:
- –í—Å–µ–≥–æ —Å—Ç–∞—Ç–µ–π: ${patterns.totalPosts}
- –ò–Ω—Ç–µ—Ä–≤—å—é: ${patterns.patterns.interviews}
- –õ–æ–Ω–≥—Ä–∏–¥–æ–≤: ${patterns.patterns.longForm}
- –°—Ç–∞—Ç–µ–π —Å –≤–∏–¥–µ–æ: ${patterns.patterns.withVideo}

–ó–∞–¥–∞–Ω–∏–µ:
1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 20-25 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º—ã
2. –†–∞–∑–¥–µ–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ 6-7 —Å–º—ã—Å–ª–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
3. –ö–∞–∂–¥—ã–π –±–ª–æ–∫ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å:
   - –ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞
   - –¶–µ–ª—å –±–ª–æ–∫–∞ (—á—Ç–æ —Ö–æ—Ç–∏–º —É–∑–Ω–∞—Ç—å)
   - 3-4 –≤–æ–ø—Ä–æ—Å–∞

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≤–æ–ø—Ä–æ—Å–∞–º:
- –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–Ω–µ –¥–∞/–Ω–µ—Ç)
- –ü—Ä–æ—Å—è—Ç –ø—Ä–∏–º–µ—Ä—ã –∏ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É
- –ü—Ä–æ–≤–æ—Ü–∏—Ä—É—é—Ç –≥–ª—É–±–æ–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
- –í—ã–∑—ã–≤–∞—é—Ç —ç–º–æ—Ü–∏–∏ –∏ –ø–æ–º–æ–≥–∞—é—Ç —á–∏—Ç–∞—Ç–µ–ª—é relate

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
–ò—Å–ø–æ–ª—å–∑—É–π –º–∞—Ä–∫–¥–∞—É–Ω –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞:

## [–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞]
**–¶–µ–ª—å:** [–û–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏]

1. [–í–æ–ø—Ä–æ—Å 1]
2. [–í–æ–ø—Ä–æ—Å 2]
3. [–í–æ–ø—Ä–æ—Å 3]

–ù–µ –¥–æ–±–∞–≤–ª—è–π –ø—Ä–µ–∞–º–±—É–ª—É –∏–ª–∏ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ, —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–π —Å –ø–µ—Ä–≤–æ–≥–æ –±–ª–æ–∫–∞.`;

  try {
    const result = await generateContent(prompt, {
      maxTokens: 4000,
      temperature: 0.8,
    });

    if (showProgress) {
      print('\n‚úì –í–æ–ø—Ä–æ—Å—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã', 'green');
    }

    return result;
  } catch (error) {
    print(`\n‚úó –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤: ${error.message}`, 'red');
    throw error;
  }
}

/**
 * –ê–Ω–∞–ª–∏–∑ –≤–∏—Ä—É—Å–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞
 */
export async function analyzeViralPotential(context, showProgress = true) {
  if (showProgress) {
    printSection('üöÄ –ê–ù–ê–õ–ò–ó –í–ò–†–£–°–ù–û–ì–û –ü–û–¢–ï–ù–¶–ò–ê–õ–ê');
    print('\n–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ç–µ–º—ã...', 'cyan');
  }

  const prompt = `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –≤ –∫–æ–Ω—Ç–µ–Ω—Ç-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ –∏ –≤–∏—Ä—É—Å–Ω–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ.

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
${JSON.stringify(context, null, 2)}

–ó–∞–¥–∞–Ω–∏–µ:
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤–∏—Ä—É—Å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —ç—Ç–æ–π —Ç–µ–º—ã –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:

1. –õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è / "–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≥–µ—Ä–æ—è" (0-10)
2. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ —Ñ–∞–∫—Ç—ã (0-10)
3. Controversy / –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã (0-10)
4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞ –¥–ª—è —á–∏—Ç–∞—Ç–µ–ª—è (0-10)
5. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑–æ–Ω–∞–Ω—Å (0-10)
6. Shareability - –±—É–¥—É—Ç –ª–∏ –¥–µ–ª–∏—Ç—å—Å—è (0-10)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è –¥–∞–π:
- –û—Ü–µ–Ω–∫—É (0-10)
- –ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –∫–∞–∫ —É—Å–∏–ª–∏—Ç—å —ç—Ç–æ—Ç –∞—Å–ø–µ–∫—Ç

–í –∫–æ–Ω—Ü–µ:
- –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ (—Å—Ä–µ–¥–Ω–µ–µ)
- 3-5 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∫–∞–∫ —É—Å–∏–ª–∏—Ç—å –≤–∏—Ä—É—Å–Ω–æ—Å—Ç—å
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–∏—Å–∫–∞—Ö

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ - –º–∞—Ä–∫–¥–∞—É–Ω, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –ª–µ–≥–∫–æ —á–∏—Ç–∞–µ–º—ã–π.`;

  try {
    const result = await generateContent(prompt, {
      maxTokens: 3000,
      temperature: 0.7,
    });

    if (showProgress) {
      print('\n‚úì –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω', 'green');
    }

    return result;
  } catch (error) {
    print(`\n‚úó –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ${error.message}`, 'red');
    throw error;
  }
}

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SEO-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
 */
export async function generateSEOStrategy(context, showProgress = true) {
  if (showProgress) {
    printSection('üîç –ì–ï–ù–ï–†–ê–¶–ò–Ø SEO-–°–¢–†–ê–¢–ï–ì–ò–ò');
    print('\n–§–æ—Ä–º–∏—Ä—É—é SEO-—Å—Ç—Ä–∞—Ç–µ–≥–∏—é...', 'cyan');
  }

  const prompt = `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –≤ SEO –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
${JSON.stringify(context, null, 2)}

–ó–∞–¥–∞–Ω–∏–µ:
–†–∞–∑—Ä–∞–±–æ—Ç–∞–π SEO-—Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏:

1. **–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:**
   - –û—Å–Ω–æ–≤–Ω—ã–µ (high volume, —Å—Ä–µ–¥–Ω—è—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è)
   - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ (—Å—Ä–µ–¥–Ω–∏–π volume)
   - –î–ª–∏–Ω–Ω—ã–π —Ö–≤–æ—Å—Ç (low volume, low competition)

2. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:**
   - 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ title (55-60 —Å–∏–º–≤–æ–ª–æ–≤)
   - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ description (150-160 —Å–∏–º–≤–æ–ª–æ–≤)
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ URL slug

3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:**
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ H2/H3 –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
   - –ì–¥–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞

4. **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–µ—Ä–µ–ª–∏–Ω–∫–æ–≤–∫–∞:**
   - –ù–∞ –∫–∞–∫–∏–µ —Ç–∏–ø—ã —Å—Ç–∞—Ç–µ–π —Å—Å—ã–ª–∞—Ç—å—Å—è
   - –ö–∞–∫–∏–µ –∞–Ω–∫–æ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

5. **Featured snippet optimization:**
   - –ö–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ featured snippets

–£—á–∏—Ç—ã–≤–∞–π:
- –†—É—Å—Å–∫–æ—è–∑—ã—á–Ω—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–∏—Å–∫–æ–≤—ã–µ –∏–Ω—Ç–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ - –º–∞—Ä–∫–¥–∞—É–Ω.`;

  try {
    const result = await generateContent(prompt, {
      maxTokens: 3500,
      temperature: 0.6,
    });

    if (showProgress) {
      print('\n‚úì SEO-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–æ—Ç–æ–≤–∞', 'green');
    }

    return result;
  } catch (error) {
    print(`\n‚úó –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SEO-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: ${error.message}`, 'red');
    throw error;
  }
}

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Ç–∞—Ç—å–∏
 */
export async function generateArticleStructure(context, showProgress = true) {
  if (showProgress) {
    printSection('üìã –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–¢–†–£–ö–¢–£–†–´ –°–¢–ê–¢–¨–ò');
    print('\n–†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É...', 'cyan');
  }

  const patterns = analyzeSuccessfulPatterns();

  const prompt = `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –±–ª–æ–≥–æ–≤.

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
${JSON.stringify(context, null, 2)}

–£—Å–ø–µ—à–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –±–ª–æ–≥–∞:
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –ª–æ–Ω–≥—Ä–∏–¥–æ–≤: 4000-6000 —Å–ª–æ–≤
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –∏–Ω—Ç–µ—Ä–≤—å—é, –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ, –º–Ω–æ–≥–æ –≤–∏–∑—É–∞–ª–∞

–ó–∞–¥–∞–Ω–∏–µ:
–†–∞–∑—Ä–∞–±–æ—Ç–∞–π –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç–∞—Ç—å–∏ —Å:

1. **–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ** (200-300 —Å–ª–æ–≤)
   - –ö—Ä—é—á–æ–∫
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç
   - –ß—Ç–æ —É–∑–Ω–∞–µ—Ç —á–∏—Ç–∞—Ç–µ–ª—å

2. **–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã**
   - –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞
   - –¶–µ–ª–µ–≤–æ–π –æ–±—ä–µ–º (—Å–ª–æ–≤–∞)
   - –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã
   - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

3. **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ** (100-200 —Å–ª–æ–≤)
   - –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã
   - Call to action

4. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
   - –¶–µ–ª–µ–≤–æ–π –æ–±—ä–µ–º —Å—Ç–∞—Ç—å–∏
   - –í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/–≥—Ä–∞—Ñ–∏–∫–æ–≤
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ–¥–∏–∞ (–≤–∏–¥–µ–æ, —Ç–∞–±–ª–∏—Ü—ã –∏ —Ç.–¥.)

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ - –º–∞—Ä–∫–¥–∞—É–Ω —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–µ–∫—Ü–∏—è–º–∏.`;

  try {
    const result = await generateContent(prompt, {
      maxTokens: 3000,
      temperature: 0.7,
    });

    if (showProgress) {
      print('\n‚úì –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞', 'green');
    }

    return result;
  } catch (error) {
    print(`\n‚úó –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: ${error.message}`, 'red');
    throw error;
  }
}

/**
 * –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
 */
export async function analyzeCompetitors(context, competitorInfo = '', showProgress = true) {
  if (showProgress) {
    printSection('üîé –ê–ù–ê–õ–ò–ó –ö–û–ù–ö–£–†–ï–ù–¢–û–í');
    print('\n–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç...', 'cyan');
  }

  const prompt = `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º –∞–Ω–∞–ª–∏–∑–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–¢–µ–º–∞: ${context.topic}
${context.format ? `–§–æ—Ä–º–∞—Ç: ${context.format}` : ''}
${context.targetAudience ? `–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: ${context.targetAudience}` : ''}

${competitorInfo ? `–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞—Ö:\n${competitorInfo}` : '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞—Ö –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞.'}

–ó–∞–¥–∞–Ω–∏–µ:
1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —á—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ —ç—Ç–æ–π —Ç–µ–º–µ
2. –ù–∞–π–¥–∏ –ø—Ä–æ–±–µ–ª—ã (content gaps) - —á—Ç–æ –ù–ï –æ—Å–≤–µ—â–µ–Ω–æ
3. –û–ø—Ä–µ–¥–µ–ª–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —É–≥–æ–ª –ø–æ–¥–∞—á–∏
4. –î–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞–∫ –≤—ã–¥–µ–ª–∏—Ç—å—Å—è

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
## –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å
[–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞]

## –ü—Ä–æ–±–µ–ª—ã –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
[–ß—Ç–æ –Ω–µ –æ—Å–≤–µ—â–µ–Ω–æ –∏–ª–∏ –æ—Å–≤–µ—â–µ–Ω–æ –ø–ª–æ—Ö–æ]

## –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —É–≥–æ–ª
[–ö–∞–∫ –ø–æ–¥–∞—Ç—å —Ç–µ–º—É –ø–æ-–Ω–æ–≤–æ–º—É]

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
[–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏]`;

  try {
    const result = await generateContent(prompt, {
      maxTokens: 2500,
      temperature: 0.7,
    });

    if (showProgress) {
      print('\n‚úì –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω', 'green');
    }

    return result;
  } catch (error) {
    print(`\n‚úó –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤: ${error.message}`, 'red');
    throw error;
  }
}

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏
 */
export async function generateDistributionPlan(context, showProgress = true) {
  if (showProgress) {
    printSection('üì¢ –ü–õ–ê–ù –î–ò–°–¢–†–ò–ë–£–¶–ò–ò');
    print('\n–§–æ—Ä–º–∏—Ä—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è...', 'cyan');
  }

  const prompt = `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –≤ –∫–æ–Ω—Ç–µ–Ω—Ç-–¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–∏.

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
${JSON.stringify(context, null, 2)}

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –∞–≤—Ç–æ—Ä–∞:
- Telegram –∫–∞–Ω–∞–ª
- LinkedIn
- Email —Ä–∞—Å—Å—ã–ª–∫–∞
- –°–∞–π—Ç/–±–ª–æ–≥

–ó–∞–¥–∞–Ω–∏–µ:
–†–∞–∑—Ä–∞–±–æ—Ç–∞–π –ø–ª–∞–Ω –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:

1. **Telegram:**
   - 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∞–Ω–æ–Ω—Å–∞ (—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –∏–Ω—Ç—Ä–∏–≥–∞, –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–π)
   - –õ—É—á—à–µ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
   - –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ engagement

2. **LinkedIn:**
   - –§–æ—Ä–º–∞—Ç –ø–æ—Å—Ç–∞
   - –•–µ—à—Ç–µ–≥–∏
   - –ö–∞–∫ –ø—Ä–∏–≤–ª–µ—á—å –≤–Ω–∏–º–∞–Ω–∏–µ B2B –∞—É–¥–∏—Ç–æ—Ä–∏–∏

3. **Email —Ä–∞—Å—Å—ã–ª–∫–∞:**
   - –¢–µ–º–∞ –ø–∏—Å—å–º–∞ (2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–Ω–æ–Ω—Å–∞

4. **–†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è:**
   - –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Å—Ç–∞—Ç—å—é –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –ò–¥–µ–∏ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø–µ—Ä–µ–ª–∏–Ω–∫–æ–≤–∫–∏

5. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**
   - –ö–∞–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∂–∏–∑–Ω—å —Å—Ç–∞—Ç—å–∏
   - –ò–¥–µ–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ - –º–∞—Ä–∫–¥–∞—É–Ω —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏.`;

  try {
    const result = await generateContent(prompt, {
      maxTokens: 3000,
      temperature: 0.8,
    });

    if (showProgress) {
      print('\n‚úì –ü–ª–∞–Ω –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –≥–æ—Ç–æ–≤', 'green');
    }

    return result;
  } catch (error) {
    print(`\n‚úó –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏: ${error.message}`, 'red');
    throw error;
  }
}

/**
 * –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ–º—ã
 */
export async function researchTopic(context, showProgress = true) {
  if (showProgress) {
    printSection('üî¨ –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï –¢–ï–ú–´');
    print('\n–ò–∑—É—á–∞—é —Ç–µ–º—É –∏ —Å–æ–±–∏—Ä–∞—é –∏–Ω—Å–∞–π—Ç—ã...', 'cyan');
  }

  const prompt = `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–µ.

–¢–µ–º–∞: ${context.topic}
${context.format ? `–§–æ—Ä–º–∞—Ç: ${context.format}` : ''}
${context.targetAudience ? `–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: ${context.targetAudience}` : ''}
${context.additionalContext ? `–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: ${context.additionalContext}` : ''}

–ó–∞–¥–∞–Ω–∏–µ:
–ü—Ä–æ–≤–µ–¥–∏ –≥–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ–º—ã:

1. **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å:**
   - –ü–æ—á–µ–º—É —ç—Ç–∞ —Ç–µ–º–∞ –≤–∞–∂–Ω–∞ —Å–µ–π—á–∞—Å?
   - –ö–∞–∫–∏–µ —Ç—Ä–µ–Ω–¥—ã —Å–≤—è–∑–∞–Ω—ã —Å –Ω–µ–π?

2. **–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:**
   - –ö–æ–º—É —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ?
   - –ö–∞–∫–∏–µ –±–æ–ª–∏/–≤–æ–ø—Ä–æ—Å—ã —É –∞—É–¥–∏—Ç–æ—Ä–∏–∏?
   - –ß—Ç–æ –æ–Ω–∏ —É–∂–µ –∑–Ω–∞—é—Ç, –∞ —á—Ç–æ –Ω–µ—Ç?

3. **–ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã:**
   - –ù–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ —Ñ–∞–∫—Ç—ã
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ –º–Ω–µ–Ω–∏—è

4. **–ì–∏–ø–æ—Ç–µ–∑—ã:**
   - –ß—Ç–æ –º–æ–∂–µ—Ç –∑–∞–π—Ç–∏ –≤ —ç—Ç–æ–π —Ç–µ–º–µ?
   - –ö–∞–∫–∏–µ —É–≥–ª—ã –ø–æ–¥–∞—á–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã?

5. **–†–∏—Å–∫–∏:**
   - –ß—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ø–æ—Ä–Ω—ã–º?
   - –ö–∞–∫–∏–µ —Ç–µ–º—ã –∏–∑–±–µ–≥–∞—Ç—å?

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Ä–∫–¥–∞—É–Ω.`;

  try {
    const result = await generateContent(prompt, {
      maxTokens: 3500,
      temperature: 0.7,
    });

    if (showProgress) {
      print('\n‚úì –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'green');
    }

    return result;
  } catch (error) {
    print(`\n‚úó –û—à–∏–±–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ç–µ–º—ã: ${error.message}`, 'red');
    throw error;
  }
}
