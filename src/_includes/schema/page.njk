{# =======================================
  КОНСТРУКТОР СУЩНОСТЕЙ ТЕКУЩЕЙ СТРАНИЦЫ
======================================== #}
{% set isHomepage = page and page.url == '/' %}
{% if not isHomepage %}

  {# 1) Базовый узел WebPage для любой непервой страницы #}
  {% set webPage = {
    "@type": "WebPage",
    "@id": (page.url | absoluteUrl(site.url)),
    "url": (page.url | absoluteUrl(site.url)),
    "name": (title.val or title) | decodeEntities | replace('"', '\\"'),
    "description": (description.val or description) | jsonLdText,
    "inLanguage": "ru",
    "datePublished": page.date | isoDate,
    "dateModified": last_modified_at | default(config.buildDate) | isoDate,
    "isPartOf": { "@id": "https://bartoshevich.by/#website" }
  } %}
  {% set currentPage = null %}

  {# 2) Специализация по типам страниц #}
  {% if page.url.startsWith('/blog/') and page.url != '/blog/' %}

    {# Для /blog/ и постов схема собирается в blog-extras.njk #}

  {% elif page.url == '/about/' %}
    {% set currentPage = webPage | merge({
      "@type": "ProfilePage", 
      "mainEntity": { "@id": "https://bartoshevich.by/about/#person" },
      "about": { "@id": "https://bartoshevich.by/about/#person" }
    }) %}

  {% elif page.url == '/contact/' %}
    {% set currentPage = webPage | merge({ "@type": "ContactPage", "mainEntity": { "@id": "https://bartoshevich.by/about/#person" } }) %}

  {% elif page.url == '/cases/' %}
    {% set currentPage = webPage | merge({ "@type": "CollectionPage", "creator": { "@id": "https://bartoshevich.by/about/#person" } }) %}

  {% else %}
    {# Любая другая страница — просто WebPage #}
    {% set currentPage = webPage %}
  {% endif %}

  {# 3) Breadcrumbs #}
  {% include "schema/breadcrumbs.njk" %}

  {% if currentPage %}
    {% if breadcrumbId %}
      {% set currentPage = currentPage | setAttribute("breadcrumb", { "@id": breadcrumbId }) %}
    {% endif %}
    {% set _ = schemaParts.push(currentPage) %}
  {% endif %}

{% else %}

  {# Главная страница — отдельный узел HomePage с датой обновления #}
  {% set homePage = {
    "@type": "WebPage",
    "@id": (page.url | absoluteUrl(site.url)),
    "url": (page.url | absoluteUrl(site.url)),
    "name": (title.val or title) | decodeEntities | replace('"', '\\"'),
    "description": (description.val or description) | jsonLdText,
    "inLanguage": "ru",
    "datePublished": page.date | isoDate,
    "dateModified": last_modified_at | default(config.buildDate) | isoDate,
    "isPartOf": { "@id": "https://bartoshevich.by/#website" }
  } %}
  {% if image %}
    {% set primaryImageUrl = image | absoluteUrl(site.url) %}
    {% set homePage = homePage | setAttribute("primaryImageOfPage", { "@type": "ImageObject", "url": primaryImageUrl }) %}
  {% endif %}
  {% set currentPage = homePage %}
  {% include "schema/breadcrumbs.njk" %}
  {% if breadcrumbId %}
    {% set homePage = homePage | setAttribute("breadcrumb", { "@id": breadcrumbId }) %}
  {% endif %}
  {% set _ = schemaParts.push(homePage) %}

{% endif %}
